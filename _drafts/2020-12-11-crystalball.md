# Crystalball
Crystalball is a Ruby library which implements [Regression Test Selection mechanism](https://tenderlovemaking.com/2015/02/13/predicting-test-failues.html)

Basic principle is that we are using code coverage to identify which specs should be checked. Because there is no sense in running specs, for files that didn't change.

This is especially helpful when all of our tests take half and hour to run. This will select only relevant tests to changes that were made.

It's worth mentioning that this is not a bulletproof solution, and it might detect too little or too many specs, especially if Your `tmp/crystalball_data.yml` is not up to date. But this should be helpful in most situations.

# How to use

1. You need to have up to date file `tmp/crystalball_data.yml`. It is generated by running `CRYSTALBALL=true bundle exec rspec .` on clean master branch with green build.
2. You have some changes done to code
3. Run `bundle exec crystalball` to build a prediction and run RSpec with it


## Possible optimizations of crystalball
 * In future, maybe we could have `tmp/crystalball_data.yml` file generated automatically on CI and only downloaded locally

## Official Getting started
Start MapGenerator in your spec_helper before you loaded any file of your app. E.g.

```ruby
if ENV['CRYSTALBALL'] == 'true'
  Crystalball::MapGenerator.start! do |config|
    config.register Crystalball::MapGenerator::CoverageStrategy.new
  end
end
```

Run your test suite with Crystaball enabled on clean master branch with green build. CRYSTALBALL=true bundle exec rspec . This step will generate file tmp/crystalball_data.yml in your project root. This file contains useful profiling data for Crystalball.

Make some changes to your app code
Run bundle exec crystalball to build a prediction and run RSpec with it. Check out RSpec runner section for customization details.


